<view class="page-container flex flex-col" bindtap="hideMenu">
  <nav-bar background="transparent" leftArrow="{{true}}" bind:leftTap="goBack" title="家庭管理"></nav-bar>

  <view class="px-48rpx pt-32rpx pb-48rpx">
    <view class="flex flex-row justify-between items-center">
      <view class="relative flex flex-row items-center shrink" bind:tap="handleShowHomeSelectMenu" id="homeName">
        <text class="max-w-520rpx text-40 text-hex-1E2C46 font-semibold leading-56rpx single-text">{{ currentHomeDetail.houseName }}</text>

        <svg-icon id="homeSelectArrow" class="absolute home-select-arrow" color="#1E2C46" name="material-symbols:arrow-drop-down-rounded" width="48rpx" height="48rpx" />
      </view>

      <image wx:if="{{currentHomeDetail.houseUserAuth === 1}}" class="w-48 h-48" src="/assets/img/home-manage/setting.png" bind:tap="toSetting"></image>
    </view>

    <view class="pt-16rpx leading-40rpx text-black-59 text-28 opacity-75">
      <text>房间{{ currentHomeDetail.roomCount }}｜设备{{ currentHomeDetail.deviceCount }}｜成员{{ currentHomeDetail.userCount }}</text>
    </view>
  </view>

  <van-cell-group inset>
    <van-cell title="家庭位置" value="{{currentHomeDetail.houseArea || positionLocation}}" value-class="single-text" is-link center link-type="navigateTo" url="/package-mine/home-location/index" />
  </van-cell-group>

  <view class="grow flex flex-col justify-between">
    <view>
      <view class="mx-24rpx rounded-32rpx bg-white overflow-hidden">
        <van-cell title="房间" is-link link-type="navigateTo" url="/package-mine/room-manage/index" border="{{ false }}" />

        <view class="flex flex-row flex-wrap px-40rpx gap-x-36rpx">
          <view wx:for="{{ showRoomList }}" wx:key="roomId" class="flex flex-col w-128" bind:tap="clickRoomItem" data-index="{{index}}">
            <view class="bg-hex-F6FAFD rounded-32rpx p-32rpx">
              <image class="w-64 h-64 block" src="/assets/img/room/{{item.roomIcon}}.png"></image>
            </view>

            <text class="pt-24rpx pb-32rpx text-28 text-center text-black-59 leading-40rpx single-text">{{item.roomName}}</text>
          </view>
        </view>
      </view>
    </view>

    <view class="block">
      <van-cell-group inset>
        <van-cell title="设备管理" is-link center data-url="/package-mine/device-manage/index" bind:click="toPage" />
      </van-cell-group>
      <van-cell-group inset>
        <van-cell title="成员管理" is-link center data-url="/package-mine/member-manage/index" bind:click="toPage" />
      </van-cell-group>
    </view>

    <view class="flex flex-row gap-46rpx pt-30rpx pb-128rpx px-32rpx">
      <van-button class="grow" size="large" bind:click="quitHome" plain wx:if="{{currentHomeDetail.houseUserAuth !== 1}}">退出家庭</van-button>

      <van-button class="grow" size="large" bind:click="toTransferHome" plain wx:if="{{currentHomeDetail.houseUserAuth === 1}}">转让家庭</van-button>

      <van-button class="grow" size="large" type="primary" bind:click="createHome">新建家庭</van-button>
    </view>
  </view>
</view>

<home-select-menu x="{{selectHomeMenu.x}}" y="{{selectHomeMenu.y}}" isShow="{{selectHomeMenu.isShow}}" bind:select="hideMenu"></home-select-menu>

<van-action-sheet show="{{ isShowSetting }}" actions="{{ settingActions }}" cancel-text="取消" bind:close="onCloseSetting" bind:select="onSelectSetting" bind:cancel="onCloseSetting" />

<van-popup round show="{{ isEditName }}" bind:close="onCloseEditName" position="bottom">
  <view class="pb-100rpx">
    <text class="block pt-48rpx pb-64rpx text-center leading-50rpx text-36 text-black-2a font-medium">家庭名称</text>

    <text class="block pl-48rpx pb-32rpx text-28">家庭名称</text>

    <view class="mx-32rpx">
      <van-field value="{{ homeInfoEdited.houseName }}" placeholder="请输入家庭名称" custom-style="padding: 20rpx 40rpx;border: 2rpx solid #DDDDDD;border-radius: 24rpx;" clearable="{{true}}" focus="{{isFocus}}" bind:change="changeHouseName"> </van-field>
    </view>

    <view class="flex flex-row gap-46rpx pt-80rpx px-32rpx">
      <van-button class="grow" size="large" bind:click="onCloseEditName">取消</van-button>

      <van-button class="grow" size="large" type="primary" bind:click="confirmHomeInfo">确定</van-button>
    </view>
  </view>
</van-popup>

<van-dialog id="van-dialog" confirm-button-color="#27282A" cancel-button-color="#27282A" />

<transfer-home-popup wx:if="{{currentHomeDetail.houseUserAuth === 1}}" show="{{isTransferHome}}" bind:close="closeTransferHome"></transfer-home-popup>
