<wxs src="/commons/wxs/util.wxs" module="module" />
<import src="/commons/templates/popup.wxml" />

<van-popup show="{{ show }}" z-index="1002" round position="bottom" bind:close="handleClose" catchtouchmove="blank" closeable>
  <view class="w-750rpx h-1200rpx relative flex flex-col items-center">
    <template is="title" data="{{title: title}}" />
    <scroll-view enhanced show-scrollbar="{{false}}" scroll-x class="mt-48rpx h-60rpx w-750rpx flex" enable-flex>
      <view class="flex">
        <view class="w-50rpx"></view>
        <view class="flex min-w-650rpx justify-center">
          <view wx:for="{{roomListComputed}}" wx:key="roomId" class="flex-col-center {{index!==0?'ml-90rpx': ''}}" data-item="{{item}}" bindtap="handleRoomSelect">
            <text class="{{roomSelect === item.roomId ? 'text-32rpx text-black-2a' : 'text-28rpx text-hex-555659'}} whitespace-nowrap">{{item.roomName}}</text>
            <view class="w-42rpx h-8rpx mt-8rpx bg-hex-488fff rounded-999 {{roomSelect === item.roomId ? 'opacity-100' : 'opacity-0'}}"></view>
          </view>
        </view>
        <view class="w-50rpx"></view>
      </view>
    </scroll-view>
    <view class="h-44rpx"></view>
    <view class="flex-1" id="content">
      <scroll-view enhanced show-scrollbar="{{false}}" scroll-y style="height: {{contentHeight}}px; width: 750rpx;">
        <view class="w-750rpx flex-col-center">
          <view wx:if="{{linkType==='scene'}}" class="w-686rpx grid grid-cols-2 gap-x-20rpx">
            <scene-card class="mt-24rpx" wx:for="{{listComputed}}" wx:key="sceneId" bind:cardTap="handleCardTap" scene-info="{{item}}" select="{{module.includes(selectList, item.sceneId)}}" />
          </view>
          <view wx:else class="w-686rpx grid grid-cols-4 gap-x-20rpx gap-y-24rpx">
            <device-card wx:for="{{listComputed}}" wx:key="uniId" bind:cardTap="handleCardTap" device-type="{{linkType === 'light' ? 'light' : 'switch'}}" device-info="{{item}}" select="{{module.includes(selectList, item.uniId)}}" bind:offlineTap="handleOfflineTap" />
          </view>
        </view>
        <view class="h-32rpx"></view>
      </scroll-view>
    </view>
    <view class="h-16rpx"></view>
    <view wx:if="{{hasReturn}}" class="flex w-686rpx">
      <van-button class="flex-1" size="large" bind:click="handleReturn">上一步</van-button>
      <view class="w-46rpx"></view>
      <van-button type="primary" class="flex-1" size="large" bind:click="handleConfirm">确定</van-button>
    </view>
    <view wx:else class="w-686rpx">
      <van-button type="primary" class="flex-1" size="large" bind:click="handleConfirm">确定</van-button>
    </view>
    <view style="height: calc(96rpx - env(safe-area-inset-bottom))"></view>
  </view>

  <van-dialog z-index="1003" use-slot title="子设备离线" show="{{ showDeviceOffline }}" confirm-button-color="#488FFF" confirmButtonText="我知道了" bind:close="handleCloseDeviceOffline">
    <view class="flex-col-center w-full">
      <image src="{{officeDeviceInfo.pic}}" class="w-160rpx h-160rpx mt-70rpx" />
      <view class="flex flex-col mt-88rpx">
        <text class="text-hex-666666 text-28rpx">可能的原因：</text>
        <text class="text-hex-555659 text-24rpx mt-16rpx">1.路由器密码被修改，建议将智能网关<text class="text-blue underline decoration-solid decoration-blue" bindtap="handleRebindGateway">重新联网</text></text>
        <text class="text-hex-555659 text-24rpx mt-8rpx">2.设备与网关未通电</text>
        <text class="text-hex-555659 text-24rpx mt-8rpx">3.设备与网关距离过远，或有其他遮挡物</text>
        <text class="text-hex-555659 text-24rpx mt-8rpx">4.路由器未通电或网络异常</text>
      </view>
      <view class="h-80rpx"></view>
    </view>
  </van-dialog>

  <van-toast id="van-toast" />
</van-popup>
